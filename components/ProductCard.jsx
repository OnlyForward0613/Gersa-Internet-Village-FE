import Image from "next/image";
import Button from "./Button";
import { BsPencilSquare, BsTrash } from "react-icons/bs";
import { useState, useEffect } from "react";
import { useRouter } from "next/router";
import { trackPromise } from "react-promise-tracker";

const ProductCard = ({ product, products, setProducts, baseURL, token }) => {
  const { image, name, isAvailable, price, id } = product;
  const [toDelete, setToDelete] = useState(false);
  const [imageType, setImageType] = useState();
  const [refreshToken, setRefreshToken] = useState("");
  const router = useRouter();

  useEffect(() => {
    typeof image === "string" ? setImageType("string") : setImageType("file");
  }, [image]);

  return (
    <div className="w-full h-fit z-1 bg-pwgray-200/90 p-4 rounded-lg shadow">
      <div
        className="rounded-lg overflow-hidden"
        onClick={() => {
          router.push(`/products/details/${id}`);
          localStorage.setItem("param", JSON.stringify(id));
        }}
      >
        {image && imageType === "string" ? (
          <Image
            src={image}
            blurDataURL={
              "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4QBWRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAAEsAAAAAQAAASwAAAAB/+0ALFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAQAAAgAEAP/hDIFodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0n77u/JyBpZD0nVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkJz8+Cjx4OnhtcG1ldGEgeG1sbnM6eD0nYWRvYmU6bnM6bWV0YS8nIHg6eG1wdGs9J0ltYWdlOjpFeGlmVG9vbCAxMC4xMCc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp0aWZmPSdodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyc+CiAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICA8dGlmZjpYUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpYUmVzb2x1dGlvbj4KICA8dGlmZjpZUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpZUmVzb2x1dGlvbj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wTU09J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8nPgogIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnN0b2NrOmVlNzFhZDM4LWQ1ODMtNDM0Yy04OTNlLWI4ZmJkZDljNjFhMDwveG1wTU06RG9jdW1lbnRJRD4KICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjk3NTk0YTI4LWIyZTItNDc5MS04NTE2LTNlYzdlM2YwOWYxMDwveG1wTU06SW5zdGFuY2VJRD4KIDwvcmRmOkRlc2NyaXB0aW9uPgo8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSd3Jz8+/9sAQwAFAwQEBAMFBAQEBQUFBgcMCAcHBwcPCwsJDBEPEhIRDxERExYcFxMUGhURERghGBodHR8fHxMXIiQiHiQcHh8e/9sAQwEFBQUHBgcOCAgOHhQRFB4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4e/8AAEQgBaAIcAwERAAIRAQMRAf/EABcAAQEBAQAAAAAAAAAAAAAAAAABAgj/xAAdEAEBAQACAwEBAAAAAAAAAAAAAUERITFxgWGR/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFREB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AAAAAAABPgAAAAFAAABAAAUAAEABQQFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvAAKCaACgAAAAAgLAAAAAASAUAAAAEAAAABQAAAAQDQUEABQAAAAAAAAAAAIAAAAAACAoAAAAAAAAAAAAAKCAoAIAAAACgAACxBDkAAEAAAAAAAAAAAAAAAAgKAAAAAAAAAAAAAAAAAACAAoAAICgAAAAAAAAAAoIAABgAKAAAACAAAAgAAAFAAwAAAAAAAAACAAAAAAoAAAAIACgAAAAAAgAAAAKACAoAAAAAEAAAAAABQTQAUAAFBkAAAEAAAoAAAAAAAAAAICgAAAoAICggAAAAKAAAAAAACAAoIACgAAAAAAAAAAAAAAAAoAAAAAIAACAAAAAAAAAAAAAAAlBQAAAAUEBQQAADQAAAUEBQAQFABAAAUAEBQAAAAAAAAAAAAL4AABQIAAB2CAgAAFAAAAA6BAAUAAAEABQQFAAAAAAAAAAAAAAAAAABQQAAAFAABAUAEBQAAAAAMAAAAAAABQAT+AgAAAAAFAABAAAAUAAAEAABQAAAKACggFAAAAA6AAAAA4AAAAAAAABQQFBAAUAAAAAAAACAAAAAAUEAAABAUAAAEAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX0CAAoAAAAAAAAAAKADNAAABAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAEBQAAAAAAAAAAUAAAEBQAIAABQAAAAAAQEAAAAAAAAAAAAAAAAAAAABQQFBAUAEAAAAABQAAAAQAAFAAAAAAAAAAAABQQFAAAAAAAAAABkAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAICgAgKCAAoAAAAAAAAAAAAKCAoAAAAAAAAAAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAAAACggAAAAEABQAAAAAMAAAAAAABQAAQFAAAAAABkAAAAEBQAQAFBAUAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAUEBQAAAAAANAAAAAAAABQAAIAAAD/2Q=="
            }
            alt="product Image"
            height={80}
            width={80}
            layout="responsive"
            placeholder="blur"
          />
        ) : image && imageType === "file" ? (
          <Image
            src={URL.createObjectURL(image)}
            blurDataURL={
              "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4QBWRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAAEsAAAAAQAAASwAAAAB/+0ALFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAQAAAgAEAP/hDIFodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0n77u/JyBpZD0nVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkJz8+Cjx4OnhtcG1ldGEgeG1sbnM6eD0nYWRvYmU6bnM6bWV0YS8nIHg6eG1wdGs9J0ltYWdlOjpFeGlmVG9vbCAxMC4xMCc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp0aWZmPSdodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyc+CiAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICA8dGlmZjpYUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpYUmVzb2x1dGlvbj4KICA8dGlmZjpZUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpZUmVzb2x1dGlvbj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wTU09J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8nPgogIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnN0b2NrOmVlNzFhZDM4LWQ1ODMtNDM0Yy04OTNlLWI4ZmJkZDljNjFhMDwveG1wTU06RG9jdW1lbnRJRD4KICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjk3NTk0YTI4LWIyZTItNDc5MS04NTE2LTNlYzdlM2YwOWYxMDwveG1wTU06SW5zdGFuY2VJRD4KIDwvcmRmOkRlc2NyaXB0aW9uPgo8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSd3Jz8+/9sAQwAFAwQEBAMFBAQEBQUFBgcMCAcHBwcPCwsJDBEPEhIRDxERExYcFxMUGhURERghGBodHR8fHxMXIiQiHiQcHh8e/9sAQwEFBQUHBgcOCAgOHhQRFB4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4e/8AAEQgBaAIcAwERAAIRAQMRAf/EABcAAQEBAQAAAAAAAAAAAAAAAAABAgj/xAAdEAEBAQACAwEBAAAAAAAAAAAAAUERITFxgWGR/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAMAwEAAhEDEQA/AOwWxQQAADAAANAAAAAAAAA4ABAUAAACAAAAAAAAQFAAAAABAUEAAAAAAAAAAAABQAAAAAAAQFBAAAUCAAAAgAAAAAAAAAAAEAAAAAABQQFBAAAAIACgAAAAAAAAAAgKCAAoICggAKAAAAAAAAAAAAAAAgKAAAAAAAAIAAAAAABAAAAAUAAEABQQAAFAAAgKCAAAUAAAAAEBQAAAAAAAAAAAAAAAAAAAAALQAAKAAAAACAoIACgAAgAAAAKAAAAAAAACAoEAAgAAAAAAAAAAAAAAAAICgAAAAAAAAAegAAAAAAUE4AAAABAUEBQAQFABAAAAAUEABQAAAAAAAAAAAAPQAAAAAAAAAAAAAAAAAAAAALgIAAAAACggCC8xQBAAANAABAAAAUAAAAAEBQQFAAAAAABAUAAAAAFA0EoAAAAAAAAAAAAAAAGgAAAAoIAAACgAn6ACggKACAAAAAAAAAAAAAAAAAgKAAAAAAAABgAAAKAACAAAAAAAAAAAAAAAAaAAABoAKCAAAoHQAIAC/QAAAQAAAAAAAAAAAEBQAQAFAAAAAAAAAAAAA0AAFBAAAAAAAAP0AAAAAAAADAAAAICggAAAKAAB8AAAgIAAAB7AAAAAAAAAAAwEBQAAJ4AAAAAAgAAAAAAAAAAAAICgAAAAAAAAAAAAaAABQAAAAAAUAEBQAAQAAAAAAAAAAAAACgAAAUAAAAAAAAAAFBAUEoAAAAAAAAAAAAAAAAAAAAAAKCAoAAAAAHAICgAnIAKCAAAAAAAAAAAAAAAAAAAAAAAAYAAAAACggH0AAAAAAAAAAAAAAAAFBAAAAAUAAAAAAAAAAAEAAAAwAAAAADgAAAAAAAAAAACAAAAAWdy99foKAAACAAAAaAAAAAAAAAAAAAAAAACgAAAAAAAnYKAAACAAAUAAAAAAFBAAAAAIACggGgAoIAAACgAlvHYHPIKACAAAAAAAAAAAAAAYBAAAAUAAAAAAAAAAD+AAAAAgAAAAAAAAAKCAAAAAAAAAAAAAAAAAoICggAAAFAAAAAAAAoAAAAAAAKCAAoIACgAAnoFAAAAAA8AgLQAQAAAAAFBAAAAANAA6AA0AAAAAAAAAFABAAAAAAAAAAAUEAAAAA4AAABQOAIAAAABwAAAAAAACAAAAAAAAAAAoIAAAAAAAAAAAAAACggAAKACAAAAAAAAAAYAAAAAAAAAC4AACcgAoAFBAUAAAAAEAAAAAAAAABQAQAAAAAAAAAADQAAAAAAUAEA0AAAAAAAAAAAADAAAAMAAAAABQQCAoAAAAAAHYAIACgAgAAGAAvAAAIAAAAAACggAAAAAAAAAKCAAoIAAAAAAAAAAAAAAAAACgAAAAAAAAeOgMAA+ATyCAoIAAAAAAAAAACggAAAAAAAAAAAAAAAAAAKCYAABgAAAAAAAAAAAAAAKCAoAAHIAAAAAAAAAAAAFBAAUE4AAAAABQQFBAAANAAAAAABQQAAAAFAAAABMAAAAAAAAAAAAAABQSgoAAAAAE8dgAYAAAAAACAoAAAAAAIAAAAAAAAAACggAAAAAAALAAQAFAAAAABAAAAAUEAAAAABQAAAAAAAAAAAUEAAABAUEBQQAAFBAAAAAAUEAAAAAABQQAAAAACAAAAQFBNBQQAAAAAAAAAFABAAUACgAAAAAAAAAAAAAAgKAAAACAoAIAACgAAAgFAAAAABQANAABAUAAAAAAAAEAAAAAABQQAFABAUAAADgAAAAAAAAAAFBAAQFABAUAAEBQQFgAAIAAAAAAACgAAAewQAFAAAAABICgAAgAAAKCAAAAoAAGAAAAAAAAAAAAeQAAAX4CAAAAgALgAICggAAFBQQAADsAAAFBAUAAEABQAAAAAAAAAAQAAAAAAFAAAAAzsAAAAAAAAAAAFBAAUEAABL4AAAAAAAAAAAAAAoAAAAAAKBoAICggAKBoAAAAAIAAAAAC0AAACggKAAAAAAAAAAAAAAAAACAYAAAAAAAAAACggAAAAAAAAAAAKCAAAAAQDkFAAAABAAAAAAOwAUAEBQAAAAAAAUEAAAAAA0AFBAQCgAAAAAAAAoIABQAAAAAAAAUEAAAABQQAAAFAAABKAAAACgAlABQAAAAAAAAAAUEAAAAAAAABQZAAA/AAAAAAAAAAAAAAAAAIACggKCAoIAACggAAKAAACAAAAoIACggKAAAAAAACggKCAAAAAAAoAAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFABAAUAE8goAAAAAAAAEAAAA5/ASAAAAAAAAAAAgKAAAAACAAoGgAAAAAAAAAAAAAAAAAAAAAAAAuAgAAFABYAABoAAAFAAAAAAAABPgAAAAFAAABAAAUAAEABQQFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvAAKCaACgAAAAAgLAAAAAASAUAAAAEAAAABQAAAAQDQUEABQAAAAAAAAAAAIAAAAAACAoAAAAAAAAAAAAAKCAoAIAAAACgAACxBDkAAEAAAAAAAAAAAAAAAAgKAAAAAAAAAAAAAAAAAACAAoAAICgAAAAAAAAAAoIAABgAKAAAACAAAAgAAAFAAwAAAAAAAAACAAAAAAoAAAAIACgAAAAAAgAAAAKACAoAAAAAEAAAAAABQTQAUAAFBkAAAEAAAoAAAAAAAAAAICgAAAoAICggAAAAKAAAAAAACAAoIACgAAAAAAAAAAAAAAAAoAAAAAIAACAAAAAAAAAAAAAAAlBQAAAAUEBQQAADQAAAUEBQAQFABAAAUAEBQAAAAAAAAAAAAL4AABQIAAB2CAgAAFAAAAA6BAAUAAAEABQQFAAAAAAAAAAAAAAAAAABQQAAAFAABAUAEBQAAAAAMAAAAAAABQAT+AgAAAAAFAABAAAAUAAAEAABQAAAKACggFAAAAA6AAAAA4AAAAAAAABQQFBAAUAAAAAAAACAAAAAAUEAAABAUAAAEAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX0CAAoAAAAAAAAAAKADNAAABAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAEBQAAAAAAAAAAUAAAEBQAIAABQAAAAAAQEAAAAAAAAAAAAAAAAAAAABQQFBAUAEAAAAABQAAAAQAAFAAAAAAAAAAAABQQFAAAAAAAAAABkAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAICgAgKCAAoAAAAAAAAAAAAKCAoAAAAAAAAAAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAAAACggAAAAEABQAAAAAMAAAAAAABQAAQFAAAAAABkAAAAEBQAQAFBAUAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAUEBQAAAAAANAAAAAAAABQAAIAAAD/2Q=="
            }
            alt="product Image"
            height={80}
            width={80}
            layout="responsive"
            placeholder="blur"
          />
        ) : (
          ""
        )}
      </div>
      <div className="flex flex-row justify-between my-2">
        <div className="font-pally lg:text-xl uppercase">
          {name?.length < 18 ? name : name?.substring(0, 18) + "..."}
        </div>
        <span
          className={
            isAvailable
              ? "bg-pwsuccess-100 md:bg-pwsuccess-300 lg:bg-pwsuccess-100 w-fit h-fit lg:h-fit md:h-4 px-2 rounded-lg flex flex-row items-center"
              : "bg-pwdanger-100 md:bg-pwdanger-300 lg:bg-pwdanger-100 w-fit h-fit lg:h-fit md:h-4 px-2 rounded-lg flex flex-row items-center"
          }
        >
          <span
            className={
              isAvailable
                ? "font-pally text-sm lg:text-sm md:text-[0] text-pwsuccess-300"
                : "font-pally text-sm lg:text-sm md:text-[0] text-pwdanger-300"
            }
          >
            {isAvailable ? "Available" : "Unavailable"}
          </span>
        </span>
      </div>
      <div className="flex flex-col lg:flex-row justify-between">
        <span className="font-excon text-xl">{`₵ ${price}`}</span>
        <div className="flex gap-1">
          <div
            onClick={() => {
              router.push(`/products/edit/${product.id}`);
              localStorage.setItem("param", JSON.stringify(product.id));
            }}
          >
            <Button text={"Edit"} icon={<BsPencilSquare />} mode={"normal"} />
          </div>
          {!toDelete ? (
            <div onClick={() => setToDelete(true)}>
              <Button text={"Delete"} icon={<BsTrash />} mode={"red"} />
            </div>
          ) : (
            <div
              onClick={() => {
                setRefreshToken(
                  JSON.parse(localStorage.getItem("pwmerchantToken"))
                );

                if (!token && refreshToken) {
                  trackPromise(
                    fetch(`${baseURL}/merchant/token`, {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify({
                        refreshToken: refreshToken,
                      }),
                    })
                      .then((res) => {
                        res.json().then((data) => {
                          if (data.success !== false) {
                            fetch(`${baseURL}/product/${id}`, {
                              method: "DELETE",
                              headers: {
                                Authorization: `Bearer ${data.token}`,
                              },
                            })
                              .then((res) =>
                                res.json().then((data2) => {
                                  if (data2.success != false) {
                                    const temp = products;
                                    temp = temp.filter((p) => p !== product);
                                    setProducts(temp);
                                  }
                                })
                              )
                              .catch((error) => console.error(error));
                          }
                        });
                      })
                      .catch((error) => console.error(error))
                  );
                }
              }}
            >
              <Button text={"Confirm"} icon={<BsTrash />} mode={"red"} />
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default ProductCard;
